@{
    ViewData["Title"] = "Firebase Login";
}
<h2 class="margin-top">Sign in with Email</h2>

@if (ViewBag.Error != null)
{
    <div style="color:red">@ViewBag.Error</div>
}
<div class =register-form>
  <form id="loginForm">
    <label>Email:</label>
    <input type="email" name="email" required />
    <br />
    <label>Password:</label>
    <input type="password" name="password" required />
    <br />
    <button type="submit">Login</button>
</form>
</div>

<style>
    .margin-top {
        margin-top: 20px;
    }
  .register-form {
        display: grid;
        justify-content: center;
        align-items: center;
    }
    .h2 ,h2 {
        text-align: center;
    }
    form {
        background-color: white;
        padding: 20px 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        width: 600px;
    }

    label {
        display: block;
        margin-top: 10px;
        font-weight: bold;
        color: #333;
    }

    input[type="email"],
    input[type="password"] {
        width: 100%;
        padding: 8px;
        margin-top: 5px;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-sizing: border-box;
    }

    button {
        width: 100%;
        margin-top: 15px;
        padding: 10px;
        background-color: #007bff;
        border: none;
        border-radius: 5px;
        color: white;
        font-size: 16px;
        cursor: pointer;
    }

    button:hover {
        background-color: #0056b3;
    }
</style>
@section Scripts {
  <!-- 1. MUST come before loading Firebase SDKs -->
<script>
  self.FIREBASE_APPCHECK_DEBUG_TOKEN = true;
</script>
  
<script type="module">
  // Import the functions you need from the SDKs
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword,signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  const firebaseConfig = { 
    apiKey: "your-api-key",
    authDomain: "your-auth-domain",
    projectId: "your-project-id",

   };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  loginForm.addEventListener('submit',async (e) => {
      e.preventDefault();
      const email = loginForm['email'].value;
      const pass = loginForm['password'].value;
      loginForm.reset();
      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, pass);
        const idToken = await userCredential.user.getIdToken();
        await postIdTokenToSessionLogin('/Login/UserLogin', idToken);

        await auth.signOut();
        window.location.assign('/Home/Index');
        } catch (error) {
            console.error("Login failed", error);
        }
    });
    function postIdTokenToSessionLogin(url, idToken) {
        return fetch(url, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        // Match the C# 'LoginRequest' property name 'IdToken'
        body: JSON.stringify({ IdToken: idToken }) 
        }).then(response => {
            if (!response.ok) {
                throw new Error('Failed to create session cookie');
            }
            return response.json();
        });
    }
</script>

}
